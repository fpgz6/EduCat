# 路由交换

## OSPF协议

> OSPF(Open Shortest Path First)是一个内部网关协议(Interior Gateway Protocol,简称IGP)，用于在单一自治系统(autonomous system,AS)内决策路由。与RIP相对，OSPF是链路状态路由协议，而RIP是距离向量路由协议。

### 概念
+ 骨干区域：起到了让其他非骨干区域能够知道别的区域的网络情况的作用。也就是说，所有非骨干区域的路由信息都要流经骨干区域。  
+ 虚拟链路：是一个通过非骨干区域到骨干区域的链路。  
1. 使用目的：  
连接一个非骨干区域到一个骨干区域通过一个非骨干区域 ;
通过一个非骨干区，连接分开的两个骨干区部分。
2. 规则：  
必须在两个ABR之间进行配置;
虚链路通过的区域作为传输区域，必须有完整的路由信息;
间传输区不能是存根区。

+ OSPF的分层拓扑的优势：


    1） 降低SPF的计算频率 
	
    2） 减小路由表 
	
    3） 降低LSU更新的开销
	

### OSPF中的四种路由器

+ 内部路由器:所有端口在同一区域的路由器，维护一个链路状态数据库。
+ 主干路由器：具有连接主干区域端口的路由器。
+ 区域边界路由器(ABR): 具有连接多区域端口的路由器，一般作为一个区域的出口。ABR为每一个所连接的区域建立链路状态数据库，负责将所连接区域的路由摘要信息发送到主干区域，而主干区域上的ABR则负责将这些信息发送到各个区域。
+ 自治域系统边界路由器(ASBR): 至少拥有一个连接外部自治域网络（如非OSPF的网络）端口的路由器，负责将非OSPF网络信息传入OSPF网络。

### DR和BDR的选举

1. 问题引出

 在运行OSPF的MA网络中包括广播型和NBMA网络会存在两个问题：

    1）在一个有n个路由器的网络中，会形成（n*(n-1))/2邻居关系。

    2）邻居间LSA的泛洪扩散混乱，相同的LSA会被复制多份，

这样的工作效率显然是很低的，消耗资源，那么如何解决这个问题的呢？

2. DR与BDR的作用

1）DR（designated router）即指定路由，其负责在MA网络建立和维护邻接关系并负责LSA的同步。

2）DR与其他所有的路由器形成邻接关系并交换链路状态信息，其他路由器之间不直接交换链路状态信息，这样就大大减少了MA网络中的邻接关系数据 及交换链路状态信息消耗的资源。

3）DR一旦出现故障，其与其他路由器之间的邻接关系将全部失效，链路状态数据库也无法同步，此时就需要重新选举DR、再与非DR路由器建立邻接关系，完成LSA的同步，为了规避单点故障风险，通过选举备份指定路由器BDR，在DR失效时快速接管DR的工作。

3. DR与BDR的选举规则

1）DR/BDR的选举是基于接口的

2）接口的DR优先级越大越优先。接口的DR优先级相等时，router ID越大越优先。

3）接口DR优先级相等时，router ID越大越优先

4）接口DR优先级为0，表示不参与选举，router priority最大不一定是DR/BDR

5）在P2P网络及P2MP网络上具有邻居关系的路由器之间会进一步建立邻接关系。但在广播型及NBMA网络上，非DRBDR路由器之间只能建立邻居关系，不能建立邻接关系。非DR/BDR路由器与DR/BDR路由器之间会建立邻接关系，DR与BDR之间也会建立邻接关系。

4. DR和BDR的选举

   1.优先级为0的不参与选举；

　 2.优先级高的路由器为DR；

　 3.优先级相同时，以router ID 大为DR；router ID 以回环接口中最大ip为准；若无回环接口，以真实接口最大ip为准。

　 4.缺省条件下，优先级为1。

   5.要注意的是,当网络中已经选举了DR/BDR后,又出现了1台新的优先级更高的路由器,DR/BDR是不会重新选举的。

   6.DR/BDR选举完成后,DRother只和DR/BDR形成邻接关系.所有的路由器将组播Hello包到AllSPFRouters地址224.0.0.5以便它们能跟踪其他邻居的信息,即DR将泛洪update packet到224.0.0.5;DRother只组播update packet到AllDRouter地址224.0.0.6,只有DR/BDR监听这个地址

    7.先选举BDR，在选举DR。

    8.ID的产生优先级：route id>loopback address>route接口最高IP

5. DR和BDR的选举需要注意以下四点：

   1）只有在广播或NBMA类型接口时才会选举DR，在点到点或点到多点类型的接口上不需要选举DR。
   2）DR是指某个网段的概念，是针对路由器的接口而言的。某台路由器在一个接口上可能是DR，在另一个接口上有可能是BDR，或者是DR Other。
   3）若DR、BDR已经选择完毕，当一台新路由器加入后，即使它的DR优先级值最大，也不会立即成为该网段中的DR。
   4）DR并不一定就是DR优先级最大的路由器；同理，BDR也并不一定就是DR优先级第二大的路由器。


## ASL协议

> OSPF(Open Shortest Path First)是一个内部网关协议(Interior Gateway Protocol,简称IGP)，用于在单一自治系统(autonomous system,AS)内决策路由。与RIP相对，OSPF是链路状态路由协议，而RIP是距离向量路由协议。

### 概念